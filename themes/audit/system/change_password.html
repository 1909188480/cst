{extend name="base" /}
{block name="body"}
<div class="layui-body">
    <!--tab标签-->
    <div class="layui-tab layui-tab-brief">
        <ul class="layui-tab-title">
            <li class="layui-this">修改密码</li>
        </ul>
        <div class="layui-tab-content">
            <div class="layui-tab-item layui-show">
                <form class="layui-form form-container" action="{:url('admin/change_password/updatePassword')}" method="post">
                    <div class="layui-form-item">
                        <label class="layui-form-label">密码</label>
                        <div class="layui-input-block">
                            <input type="password" name="old_password" id="old_password" value="" required lay-verify="required" placeholder="请输入原密码" class="layui-input">
                            <input type="hidden" name="rsapass" id="rsapass">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">密码</label>
                        <div class="layui-input-block">
                            <input type="password" name="password" value="" placeholder="请输入新密码" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-form-label">重复密码</label>
                        <div class="layui-input-block">
                            <input type="password" name="confirm_password" value="" placeholder="请再次输入新密码" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <div class="layui-input-block">
                            <button class="layui-btn" lay-submit lay-filter="x"  onclick="return forrsa()">更新</button>
                            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{/block}
{block name="js"}
<script src="__JS__/rsa.js"></script>
{/block}
{block name="script"}
<script type="text/javascript">
  function forrsa()
    {
    
       var pass=document.getElementById("old_password");
        var rsapass=document.getElementById("rsapass");
        var time={$time};
        var rsapubkey='{$pubkey}';
        rsapass.value=any_rsa_pass(rsapubkey,time+"_"+pass.value);
        form.on('submit(x)', function (data) 
        {
            $.ajax({
            url: data.form.action,
            type: data.form.method,
            data: $(data.form).serialize(),
            success: function (info) 
            {
                if (info.code === 1) 
                {
                    setTimeout(function()
                    {
                        window.location.href=info.url;
                    }, 2000);
                    layer.msg(info.msg);
                    // layer.msg(info.msg,{icon:6});
                }
                else
                {
                    layer.msg(info.msg,{icon:"&#xe69c;"});
                }
            }});
            return false;
        });
        return false;
    }
</script>
{/block}